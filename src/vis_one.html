<head xmlns="http://www.w3.org/1999/html">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <title>Question 1</title>
</head>

<body style="background-color: #121212;padding-left: 10%; font-family:verdana,serif">
<div id="my_info" style="color: #ffffff">
    <b><u>Name: </u></b> Jack Geraghty <br/>
    <b><u>Student Number: </u></b> 16384181 <br/>
    <b><u>Email: </u></b> jack.geraghty@ucdconnect.ie <br/>
    <b><u>Dataset: </u></b> Spotify Dataset<br/>
    <b><u>Initial Questions</u>:</b> How have the features that make up music changed over time? How do these features
    make up
    the music we listen to?
</div>
<hr style="color: white">
<div id="vis" style=" width: 90%;height: 65%"></div>

<div id="answer" style="background-color: #121212;width: 90%;color: #ffffff;">
    <label for="option">Use Median: </label>
    <input type="checkbox" id="option" name="avg_option" value="Use Median" onclick="visualize()">
    <hr style="color: white">

    <u><b>Question: </b></u>
    <p>How have the features that make up the music we listen to changed over the years?</p>
    <u><b>Description: </b></u>
    <p>The line chart above shows how each of the features, "acousticness", "danceability", "energy", "liveness" and
        "valence" have changed over the past few decades.
        These features are all given a score between 0.0 and 1.0. For example, a danceability score of 0.9 indicates
        that
        the song is very suitable for dancing.
    </p>
    <p>
        Hovering the cursor over any of the lines will highlight that line and grey out the others to enable the ability
        to
        focus in on any particular feature. Hovering over a data point in any of the lines will show its value at that
        point.
    </p>

    <hr style="color: white">

    <u><b>Insight: </b></u>
    <p>There are several interesting trends which have emerged in the musical features given over the past few decades
        : </p>
    <ol>
        <li>
            The most interesting and worrying trend in musical features is that of "valence". Valence is the perceived
            positvity of a track, higher meaning more positive and lower meaning more negative. Valence starts off
            relatively high,
            but sees a significant drop between the end of the 1960s and the start of the 1970s. This could be a sample
            size issue with the dataset or it could be a reflection of some real world events that were happening at the
            time.
            Both the cold war and the Vietnam War were close to their peaks in this span of time. Valence then sees an
            increase then for a couple of decades but it does ultimately start to trend downwards with a sizable drop
            starting in 2010.
            Considering that the dataset has a lot more samples for more recent years I wouldn't put this drop down to
            the data being used.
            Instead I would suggest that it is the result of significant real world events.
            2007/2008 marked the start of the Global Recession, with many austerity measures being introduced in the
            following years,
            austerity is known to have a significant impact on the mental well-being and happiness of people. This
            austerity lasted for years and during it and in the years that followed there was many global events, a lot
            of which were negative.
            There was several disasters such as the earthquake in Haiti, the tsunami off the coast of Japan which caused
            the Fukushima nuclear plant disaster and global problems such as climate change took the spotlight. Music
            and Art tends to reflect real life and this is a more worrying reflection than most.
        </li>
        <li>
            "Danceability" sees steady growth throughout the decades, this is more than likely caused by the emergence
            of new types of music, such as EDM and Techno, genres which are designed to have people dancing. These
            genres have only become more popular since they started and took off in the 1980s.
        </li>
        <li>
            "Energy", the perceived measure of intensity and activity fluctuates at different points throughout the
            decades,
            this is more than likely due to the changing tastes in music throughout the time period. It sees peaks
            during the
            80s, when the likes of The Police, U2 and Van Halen were all producing music, and also during the 2010s,
            when
            EDM and Hip-Hop were growing and becoming more popular.
        </li>

        <li>"Acousticness" had its peak back in the 1960s / 1970s and since the end of the 1970s has been relatively
            stable up until the 2020. "Acousticness" does see a rise again in the mid 1980s, country music did make a
            small
            revival during the 80s with hits from the likes of Dolly Parton and others working in the genre being
            released.
        </li>
        <li>
            "Liveness" remains stable throughout the decades, while artists have published live versions of their music
            on Spotify, the trend line matches the data available to the visualization. Upon inspection of the data set,
            I noticed only one entry had any indication of it being a live version, live versions often have live in the
            title.
            This stable value for "liveness" matches the entries in the dataset, which is a small subset, less than
            32,00 after filtering, of the full music
            catalogue available on Spotify, which is approximately 70 million songs, <a
                href="https://newsroom.spotify.com/company-info/#:~:text=Discover%2C%20manage%20and%20share%20over,and%20ad%2Dfree%20listening%20experience.">Source</a>.
        </li>
    </ol>

    <hr style="color: white">

    <u><b>Design Considerations: </b></u>
    <p>
        I used a small multiples version of a line chart to present the trend of the music features over time. Small multiples
        are a style that I ended up using a lot in this assignment due to their ability to de-clutter charts that are
        comparing many variables. Line chart were selected for the final visualization due their ease of understanding when
        it comes to trends over time. The x-axis is a natural fit for representing time. In general, line charts are simple
        and easily understandable and are a type of chart that most people are familiar with and are comfortable with. Due
        to these reasons and the lack of a better alternative I decided on using line charts to convey the information
        required to answer this question.
    </p>
    <p>
        Originally I had only used six of the nine features now present and I had originally used a multi-series line
        chart instead of the small multiples chart seen in the final chart. While I thought the multi-series line chart
        was easy to read and understand as I added more features it became more and more cluttered and ultimately the
        ability to easily identify and follow features over time diminished. More time was spent looking up the legend to
        match line colours to features and would be a nightmare for someone with any form of colour blindness.
    </p>
    <p>
        Colour is something that can make a chart look nice, but it can have a negative effect as well, especially when
        there is more than just a handful of variables being plotted. Colour isn't something I've really used in the
        final versions of all the charts in this assignment. The main reason being that the data I'm presenting has a
        lot of variables and colour would only confuse people or would take them longer to determine each of the features
        being presented.
    </p>
    <p>
        The small multiples style overcomes these issues as each chart present only a single variable and each chart has
        it's own title to indicate which feature is being used. This in combination of a tooltip detailing the exact value
        of a point alongside the feature should enable a clear understanding of what is being presented on each chart.
    </p>
    <p>
        All of features used have been normalised to be between 0 and 1 (more on this in the next section) and as such
        they all make use of a common y-axis that ranges from 0 to 1. This enables an easy comparison between trends in
        features as it is possible to get a quick estimate of where each line is in respect to the others. It is also
        easy to spot trends in each of the features using the small multiples approach as each chart isn't impeded by any
        of others, an issue I ran into with the all of the feature trends on a single chart.
    </p>
    <p>
        An alternative chart style that I considered was a variation of a highlight table. The columns would have
        represented years and the rows the corresponding aggregated feature values for those years. Then it would be
        possible for a colour gradiant to be used to show increases/decreases per cell. There are multiple issues with
        this approach, firstly the years used range from 1965 to 2020, which is 55 years. This would lead to a very long
        table that would be quite difficult to read, which would only be made worse by the colour gradiant, especially for
        those with any form of colour blindness.
    </p>
    <p>
        To address the obstacle that is having 55 columns it would be possible to group the years into a number of bins.
        This would reduce the number of columns but would come at the cost of precision, something which I didn't want to
        lose for this chart.
    </p>
    <p>
        A stacked area chart was also a contender for presenting this information compared to the multi-series line
        chart. The stacked area chart could be a way of showing what the composition of each year was in terms of the
        nine features, with the area of the chart showing the total score out of 9.0 and the individual colours showing
        how much each feature contributed to the total. Stacked area charts are useful for showing the composition of
        features to an overall value. This however didn't make sense in terms of the data, tracks aren't represented as
        some score out of nine, and the features are relatively independent of each other. Colour is another issue,
        stacked area charts suffer from the same issues with colour as general lines chart and the issues I've addressed
        about colour above. Using a stacked area chart I felt would ultimately confuse the reader and take away from what the chart was trying
        to convey, which was trends over time.
    </p>
    <p>
        Histograms are another method which could have been used, they are similar to bar charts in that they represent
        height/length using a quantitative variable. They differ though in the way the represent the other axis. In the
        context of this chart the histogram would have been constructed using binned year data on the x-axis with the
        y-axis staying the same as the final chart. Histograms are useful as they are easily understood by the majority
        and have use regular intervals which aids in this ease of understanding. A histogram on its own would not be
        sufficient for this question as there are too many variables, so comparing features and spotting trends would be
        difficult due to a cluttered graph. Small multiples would fix this issue but it also has it's problems. Year data
        would still be be binned at the cost of precision and since histograms take up a lot of area on a chart the
        data/ink ratio wouldn't necessarily be optimal.
    </p>
    <p>
        The final chart I created addresses the short comings of the small multiples histogram, data doesn't have to be
        binned at the expense of precision and lines use minimal area on a chart. Line charts are easily understood by the
        majority, enable easy comparison of the musical features present in the dataset and make it easy to spot trends
        in the series.
    </p>

    <hr style="color: white">

    <u><b>Data Filtering/Aggregation/Transforms: </b></u>
    <p>
        Data from before the year 1966 has been filtered out. Initial versions of this chart included them but the lines
        were quite erratic. Upon inspecting the dataset and the number of samples available per year I noticed that for
        the years before 1966 there was less than 10 songs. This led to both the mean and median being heavily distorted
        for
        those years.
    </p>
    <p>
        Rows which contain NaN values or Infinite values were removed to avoid any issues that they might have caused.
        No other filtering was needed for this chart.
    </p>
    <p>
        The CSV file used for this chart is a modified subset of the original data. The year was extracted from the
        "track_album_release_date" field, this was to simplify grouping. Then each column for the musical features,
        (excl. Instrumentalness, as after inspecting the data for it, it was deemed as incomplete / inaccurate in the
        context of the dataset, median was approx. 0.0 for almost every single year), the median and mean was calculated
        resulting in the final structure of the new CSV as [Year, Feature, Median, Mean]. The new CSV is available on my
        <a href="https://github.com/JackGeraghty/Info_Vis">GitHub Project</a> for this assignment, under
        data/question1.csv.
    </p>
    <p>
        One reason for doing data pre-processing in python was due to a current bug with Vega-Lite. To achieve the
        desired
        multi-series chart, there was two main options, using repeat layers, which worked pretty well for the original
        structure of the data and the second option which uses the new Feature column to determine when a new line
        should
        be created. I opted to use the second option as it meant I could also incorporate the interactive hovering and
        highlighting of lines. This wasn't possible with the repeat option due to a bug which also duplicates hover
        parameters across layers resulting in a duplicate signal error.
        This <a href="https://github.com/vega/vega-lite/issues/6890">bug</a> is still being fixed and was last updated
        without a work around on the 8th Jan. 2021.
    </p>

    <hr style="color: white">
    <hr style="color: white">

    <p>
        All work is my own, Jack Geraghty - 16384181
    </p>

    <hr style="color: white">
</div>

<script type="text/javascript">
    window.addEventListener("resize", visualize);
    visualize();

    function visualize() {
        let w = Math.floor(window.innerWidth * 0.25);
        let h = Math.floor(window.innerHeight * 0.16);
        const averageToUse = document.getElementById("option").checked ? "median" : "mean";
        const capitalizedAvgToUse = averageToUse.charAt(0).toUpperCase() + averageToUse.slice(1);
        const data = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": w,
            "height": h,
            "data": {
                "url": "https://raw.githubusercontent.com/JackGeraghty/Info_Vis/master/data/q1.csv",
                "format": {"type": "csv"}
            },

            "transform": [
                {
                    "filter": {"timeUnit": "year", "field": "track_album_release_year", "range": [1965, 2025]}
                },
            ],
            "mark": {
                "type": "line",
                "point": true
            },
            "encoding": {
                "facet": {
                    "field": "feature", "columns": 3, "header": {
                        "title": `Trends in Musical Features since the 1960s - Using ${capitalizedAvgToUse}`,
                        "titleFontSize": 20, "labelFontSize": 15
                    }
                },
                "x": {
                    "timeunit": "year", "type": "temporal", "field": "track_album_release_year", "scale": {
                        "type": "time",
                        "domain": [{"year": 1960}, {"year": 2025}]
                    },
                    "title": "Track Release Year",
                    "axis": {
                        "tickCount": {"interval": "year", "step": 5}
                    }
                },
                "y": {
                    "field": averageToUse,
                    "type": "quantitative",
                    "title": `${capitalizedAvgToUse} Feature Value`,
                    "scale": {"domain": [0, 1]},
                    "axis": {"tickCount": 10}
                },
                "tooltip": [
                    {
                        "field": "track_album_release_year", "type": "temporal", "title": "Year"
                    },
                    {
                        "field": "feature", "type": "nominal", "title": "Feature"
                    },
                    {
                        "field": averageToUse, "type": "quantitative", "title": `${capitalizedAvgToUse} Value`
                    }
                ]
            }
        };
        vegaEmbed("#vis", data);
    }
</script>
</body>