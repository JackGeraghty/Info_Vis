<head xmlns="http://www.w3.org/1999/html">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <title>Question 1</title>
</head>

<body style="background-color: #121212;padding-left: 5%; font-family:verdana,serif">
<div id="my_info" style="color: #ffffff">
    <b><u>Name: </u></b> Jack Geraghty <br/>
    <b><u>Student Number: </u></b> 16384181 <br/>
    <b><u>Email: </u></b> jack.geraghty@ucdconnect.ie <br/>
    <b><u>Dataset: </u></b> Spotify Dataset<br/>
    <b><u>Initial Questions</u>:</b> How have the features that make up music changed over time? How do these features
    make up
    the music we listen to?
</div>
<hr style="color: white">
<div id="vis" style=" width: 90%;height: 65%"></div>
<br/><br/>
<br/><br/>
<br/><br/><br/><br/>

<div id="answer" style="background-color: #121212;width: 90%;color: #ffffff;">
    <label for="option">Use Mean: </label>
    <input type="checkbox" id="option" name="avg_option" value="Use Mean" onclick="visualize()">
    <hr style="color: white">

    <u><b>Question: </b></u>
    <p>How have the features that make up the music we listen to changed over the years?</p>
    <u><b>Description: </b></u>
    <p>The line charts above shows how each of the musical features which are present in the dataset have changed over
        the past few decades. Each of the features is grouped by year and then aggregated using either the median or
        mean, there is a checkbox below the graph which can be used to switch between them.
    </p>
    <p>
        Each of the features used either were already ranging from 0 to 1 or were normalized to be between 0 and 1. The
        features value is used to indicate how much of that feature is present in the song. For example, a high value
        for danceability indicates that the song is suitable for dancing.
    </p>
    <p>
        There is also a tooltip which can be used to get an exact value for a given year. This is shown by hovering over
        a point on the chart.
    </p>
    <hr style="color: white">

    <u><b>Insight: </b></u>
    <p>
        It's clear that the features that are present in the music we listen to have changed over the past few decades.
        Some musical features have become more prevalent in music such as danceability, a measure of how good a song is
        for dancing, and energy, the perceived energy of a song and how active it is. Others have either remained the
        same, while some are worryingly in decline.
    </p>

    <p>
        Since the 1960s there has been a slow decline in the acousticness of music. This is unsurprising due to the
        shift in popular music since then. Country western and genres similar were more popular back then, partly because
        the genres that we listen to now were in their infancy or weren't even around. So it follows, that unless more
        modern genres used acoustic instruments (which they haven't), this feature would become less prevalent over
        the years. However it does has had some increases along the way and it does appear to be on the rise again. I
        think the early rise of acoustiness in the mid eighties can be put down to a resurgance in acoustic genres caused
        artists such as Dolly Parton. Then in more recent years acousticness seems to be becoming more prevalent in songs
        again. There have been some popular musicians(Ed Sheeran, Taylor Swift) who made heavy use of acoustic
        instruments in their careers, so this could have influenced to an uptake in acousticness in modern music.
    </p>
    <p>
        Danceability, energy and loudness are the three features that have shown moderate growth since the 1960s, this
        isn't all that surprising. The three of them see their rise start in the late eighties, which lines up with
        newer genres such as EDM and it's numerous sub-genres emerging, as well as a lot of music in both R&B and Rap,
        which were also starting to gain popularity in those years. I did think though that loudness would have been
        more of a factor in the 1970s as Rock and Heavy Metal were quite popular at the time. This however, could be more
        of a fault with the dataset and not having a wide enough sample to catch all music from the period. It is a
        very small subset, ~32,000, of the full Spotify which is ~70 million songs.
    </p>
    <p>
        Instrumentalness, liveness, speechiness and tempo have all remained moderately stagnant. Tempo has been up and
        down slightly over the years, and speechiness has seen small small increase. This increase does line up with the
        likes of Rap starting around the 1990s. Instrumentalness seems to be completely unused, but when you switch to
        using the mean as the method of aggregation we are reminded that there is still some music using a lot of
        instrumental sections and almost no lyrics. This is something that is covered a bit more in the final visualization.
    </p>
    <p>
        The most worrying trend is that of valence. Valence is the perceived positivity of a track, songs with values
        closer to one are more positive and those closer to 0 more negative. It has been up and down over the years,
        which is as expected, an artists' mood, which is heavily influenced by external factors
        such as war, recession, etc., can change regularly and this can be a major influence on their music. More
        worryingly though is the trend in the past decade. Since 2010, valence has decline, it has recovered slightly
        but it is noticeably down compared to previous decades. This trend can, I think, be easily explained. 2010 was
        just after the start of the global recession that impacted a massive number of lives around the world. There
        as massive unemployment and a lot of people were living close to or below the poverty line. The small increase
        can then be explained by the small increase in the year 2015, which was around the time many would say the world
        was well on it's way to recovering. This isn't without it's problems though, in the past five years there has
        been a huge increase in devastating, worldwide events. Climate change has become far more prevalent and there
        has been a big increase in the number of natural weather disasters. Terrorism has also been a regular headline
        around the world. I think when these factors are taken into account it's pretty clear why music has seen a drop
        in positivity.
    </p>

    <hr style="color: white">

    <u><b>Design Considerations: </b></u>
    <p>
        The target audience for this chart is the same as it is for all three visualizations, and that is those from who
        are more interested in music than your average person and also those with some background in data analysis such
        that they already have even a mild understanding of interpreting charts and concepts such as correlations etc.
    </p>
    <p>
        I used a small multiples version of a line chart to present the trend of the music features over time. Small
        multiples
        are a style that I ended up using a lot in this assignment due to their ability to de-clutter charts that are
        comparing many variables. Line chart were selected for the final visualization due their ease of understanding
        when
        it comes to trends over time. The x-axis is a natural fit for representing time. In general, line charts are
        simple
        and easily understandable and are a type of chart that most people are familiar with and are comfortable with.
        Due
        to these reasons and the lack of a better alternative I decided on using line charts to convey the information
        required to answer this question.
    </p>
    <p>
        Originally I had only used six of the nine features now present and I had originally used a multi-series line
        chart instead of the small multiples chart seen in the final chart. While I thought the multi-series line chart
        was easy to read and understand as I added more features it became more and more cluttered and ultimately the
        ability to easily identify and follow features over time diminished. More time was spent looking up the legend
        to
        match line colours to features and would be a nightmare for someone with any form of colour blindness.
    </p>
    <p>
        Colour is something that can make a chart look nice, but it can have a negative effect as well, especially when
        there is more than just a handful of variables being plotted. Colour isn't something I've really used in the
        final versions of all the charts in this assignment. The main reason being that the data I'm presenting has a
        lot of variables and colour would only confuse people or would take them longer to determine each of the
        features
        being presented.
    </p>
    <p>
        The small multiples style overcomes these issues as each chart present only a single variable and each chart has
        it's own title to indicate which feature is being used. This in combination of a tooltip detailing the exact
        value
        of a point alongside the feature should enable a clear understanding of what is being presented on each chart.
    </p>
    <p>
        All of features used are normalised to be between 0 and 1 (more on this in the next section) and as such
        they all make use of a common y-axis that ranges from 0 to 1. This enables an easy comparison between trends in
        features as it is possible to get a quick estimate of where each line is in respect to the others. It is also
        easy to spot trends in each of the features using the small multiples approach as each chart isn't impeded by
        any
        of others, an issue I ran into with the all of the feature trends on a single chart.
    </p>
    <p>
        An alternative chart style that I considered was a variation of a highlight table. The columns would have
        represented years and the rows the corresponding aggregated feature values for those years. Then it would be
        possible for a colour gradiant to be used to show increases/decreases per cell. There are multiple issues with
        this approach, firstly the years used range from 1965 to 2020, which is 55 years. This would lead to a very long
        table that would be quite difficult to read, which would only be made worse by the colour gradiant, especially
        for
        those with any form of colour blindness.
    </p>
    <p>
        To address the obstacle that is having 55 columns it would be possible to group the years into a number of bins.
        This would reduce the number of columns but would come at the cost of precision, something which I didn't want
        to lose for this chart.
    </p>
    <p>
        A stacked area chart was also a contender for presenting this information compared to the multi-series line
        chart. The stacked area chart could be a way of showing what the composition of each year was in terms of the
        nine features, with the area of the chart showing the total score out of 9.0 and the individual colours showing
        how much each feature contributed to the total. Stacked area charts are useful for showing the composition of
        features to an overall value. This however didn't make sense in terms of the data, tracks aren't represented as
        some score out of nine, and the features are relatively independent of each other. Colour is another issue,
        stacked area charts suffer from the same issues with colour as general lines chart and the issues I've addressed
        about colour above. Using a stacked area chart I felt would ultimately confuse the reader and take away from
        what the chart was trying
        to convey, which was trends over time.
    </p>
    <p>
        Histograms are another method which could have been used, they are similar to bar charts in that they represent
        height/length using a quantitative variable. They differ though in the way the represent the other axis. In the
        context of this chart the histogram would have been constructed using binned year data on the x-axis with the
        y-axis staying the same as the final chart. Histograms are useful as they are easily understood by the majority
        and have use regular intervals which aids in this ease of understanding. A histogram on its own would not be
        sufficient for this question as there are too many variables, so comparing features and spotting trends would be
        difficult due to a cluttered graph. Small multiples would fix this issue but it also has it's problems. Year
        data
        would still be be binned at the cost of precision and since histograms take up a lot of area on a chart the
        data/ink ratio wouldn't necessarily be optimal.
    </p>
    <p>
        The final chart I created addresses the short comings of the small multiples histogram, data doesn't have to be
        binned at the expense of precision and lines use minimal area on a chart. Line charts are easily understood by
        the
        majority, enable easy comparison of the musical features present in the dataset and make it easy to spot trends
        in the series.
    </p>

    <hr style="color: white">

    <u><b>Data Filtering/Aggregation/Transforms: </b></u>
    <p>
        Data from before the year 1966 has been filtered out. Initial versions of this chart included them but the lines
        were quite erratic. Upon inspecting the dataset and the number of samples available per year I noticed that for
        the years before 1966 there was less than 10 songs. This led to both the mean and median being heavily distorted
        for those years.
    </p>
    <p>
        Before using the dataset for any visualisations I did some general preprocessing of the dataset. This
        preprocessing was done through python. After working with dataset for a period I noticed issues with it, so I
        took this as a general opportunity to sort out the dataset that I would use for the final visualizations.
        This involved filtering out NaN and Infinity values from the dataset, there wasn't many present but they would
        cause issues during visualization if they were left in. Then I noticed that there was a significant amount of
        duplicates entries in the dataset. These were rows which had the same track_name/artist and feature values, but
        differed on the playlist_genre. There wasn't much that could be done about this. The dataset lacks the actual
        genre of a given track and instead uses whatever genre the playlist it was placed in is. To handle this,
        for the first and final visualization, all but one of these duplicates are removed, while the second one
        removes all duplicates as it deals specifically with the genres present in the dataset. More on this in
        this section of the second chart.
    </p>
    <p>
        All but one duplicate was left for this chart as it was important to not filter out data unnecessarily. All
        the duplicates have the same feature values so it is still accurate to take just one of these rows as there
        is no dependence on the playlist_genre field.
    </p>
    <p>
        Once the preprocessing was done I needed to normalize two of musical features so that they would have values
        between 0 and 1. These features were loudness and tempo. Loudness refers to the overall loudness of the track
        and is quite different from all the other features. A value of 0dB in this context refers to the loudness
        possible
        value according to spotify and -60dB being the quietest possible sound. Decibels also utilize a logarithmic
        scale, i.e. -60dB is 60x quieter than 0dB. With this in mind during preprocessing extra steps had to be taken
        to firstly convert this from logarithmic scale to linear and secondly, to normalize the linear values between
        0 and 1. The resulting loudness values are within the range 0 and 1 with previous loudness values of 0dB
        representing 1 and values of -60db representing 0. Tempo was easier to normalize, I used a standard method
        of normalizing which involves using the minimum and maximum values of tempo in the dataset to normalize between
        0 and 1.
    </p>
    <p>
        The CSV file used for this chart is a modified subset of the original data. The year was extracted from the
        "track_album_release_date" field, this was to simplify grouping. Then each column for the musical features,
        the median and mean was calculated resulting in the final structure of the new CSV as [Year, Feature, Median,
        Mean]. The new CSV is available on my <a href="https://github.com/JackGeraghty/Info_Vis">GitHub Project</a>
        for this assignment, under data/question1.csv.
    </p>

    <hr style="color: white">
    <hr style="color: white">

    <p>
        All work is my own, Jack Geraghty - 16384181
    </p>

    <hr style="color: white">
</div>

<script type="text/javascript">
    window.addEventListener("resize", visualize);
    visualize();

    function visualize() {
        let w = Math.floor(window.innerWidth * 0.275);
        let h = Math.floor(window.innerHeight * 0.15);
        const averageToUse = document.getElementById("option").checked ?  "mean" : "median";
        const capitalizedAvgToUse = averageToUse.charAt(0).toUpperCase() + averageToUse.slice(1);
        const data = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": w,
            "height": h,
            "data": {
                "url": "https://raw.githubusercontent.com/JackGeraghty/Info_Vis/master/data/q1.csv",
                "format": {"type": "csv"}
            },

            "transform": [
                {
                    "filter": {"timeUnit": "year", "field": "track_album_release_year", "range": [1965, 2025]}
                },
            ],
            "mark": {
                "type": "line",
                "point": true
            },
            "encoding": {
                "facet": {
                    "field": "feature", "columns": 3, "header": {
                        "title": `Trends in Musical Features since the 1960s - Using ${capitalizedAvgToUse}`,
                        "titleFontSize": 20, "labelFontSize": 15
                    }
                },
                "x": {
                    "timeunit": "year", "type": "temporal", "field": "track_album_release_year", "scale": {
                        "type": "time",
                        "domain": [{"year": 1960}, {"year": 2025}]
                    },
                    "title": "Track Release Year",
                    "axis": {
                        "tickCount": {"interval": "year", "step": 5}
                    }
                },
                "y": {
                    "field": averageToUse,
                    "type": "quantitative",
                    "title": `${capitalizedAvgToUse} Feature Value`,
                    "scale": {"domain": [0, 1]},
                    "axis": {"tickCount": 10}
                },
                "tooltip": [
                    {
                        "field": "track_album_release_year", "type": "temporal", "title": "Year"
                    },
                    {
                        "field": "feature", "type": "nominal", "title": "Feature"
                    },
                    {
                        "field": averageToUse, "type": "quantitative", "title": `${capitalizedAvgToUse} Value`
                    }
                ]
            }
        };
        vegaEmbed("#vis", data);
    }
</script>
</body>